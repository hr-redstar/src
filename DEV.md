# ğŸ›  é–‹ç™ºè€…ã‚¬ã‚¤ãƒ‰ (Developer Guide)

## ğŸš© å‰ææ¡ä»¶ (Prerequisites)

- **è¨€èª**: æ—¥æœ¬èªãƒã‚¤ãƒ†ã‚£ãƒ–ç’°å¢ƒï¼ˆé–‹ç™ºè€…ãƒ»åˆ©ç”¨è€…ãƒ»ãƒ­ã‚°ã®ã™ã¹ã¦ï¼‰ã€‚
- **OS**: Linuxç³»ç’°å¢ƒã‚’åŸºæº–ã¨ã—ã¾ã™ã€‚UTF-8ã‚¨ãƒ³ã‚³ãƒ¼ãƒ‡ã‚£ãƒ³ã‚°ã‚’å¿…é ˆã¨ã—ã¾ã™ã€‚
- **ãƒ•ã‚¡ã‚¤ãƒ«åæˆ¦ç•¥**: 
    - é‹ç”¨ä¸Šã®ãƒ‰ãƒ¡ã‚¤ãƒ³ç†è§£ï¼ˆDDDçš„ã‚¢ãƒ—ãƒ­ãƒ¼ãƒï¼‰ã‚’æœ€å¤§åŒ–ã™ã‚‹ãŸã‚ã€**æ„å›³çš„ã«æ—¥æœ¬èªãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªåãƒ»ãƒ•ã‚¡ã‚¤ãƒ«åã‚’æ¡ç”¨**ã—ã¦ã„ã¾ã™ã€‚
    - ã“ã‚Œã¯ã€ä»•æ§˜æ›¸ã¨ã‚³ãƒ¼ãƒ‰ã®ä¸€è‡´åº¦ã‚’é«˜ã‚ã€æ—¥æœ¬äººé–‹ç™ºè€…ãƒãƒ¼ãƒ ã®èªçŸ¥è² è·ã‚’æœ€å°åŒ–ã™ã‚‹ãŸã‚ã®æˆ¦ç•¥çš„æ±ºå®šã§ã™ã€‚
    - OSã®åˆ¶ç´„ã«ã‚ˆã‚Šå•é¡ŒãŒç™ºç”Ÿã—ãŸå ´åˆã¯ã€ãƒ•ã‚¡ã‚¤ãƒ«åã§ã¯ãªãOSç’°å¢ƒå´ã‚’èª¿æ•´ï¼ˆLinux/Dockerç’°å¢ƒã®ç¶­æŒï¼‰ã™ã‚‹æ–¹é‡ã‚’ã¨ã‚Šã¾ã™ã€‚


## ğŸ— ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆæ§‹é€  (Directory Structure)

```
src/
â”œâ”€ .github/             # GitHub Actions ãƒ¯ãƒ¼ã‚¯ãƒ•ãƒ­ãƒ¼
â”œâ”€ bot/                 # ãƒœãƒƒãƒˆã‚½ãƒ¼ã‚¹ã‚³ãƒ¼ãƒ‰æœ¬ä½“
â”‚  â”œâ”€ command/          # ã‚¹ãƒ©ãƒƒã‚·ãƒ¥ã‚³ãƒãƒ³ãƒ‰å®šç¾©
â”‚  â”œâ”€ event/            # Discord ã‚¤ãƒ™ãƒ³ãƒˆãƒãƒ³ãƒ‰ãƒ©
â”‚  â”œâ”€ handler/          # ã‚¤ãƒ³ã‚¿ãƒ©ã‚¯ã‚·ãƒ§ãƒ³ (Button/Modal/Select)
â”‚  â”œâ”€ utils/            # å…±é€šãƒ¦ãƒ¼ãƒ†ã‚£ãƒªãƒ†ã‚£
â”‚  â”œâ”€ storage/          # ãƒ‡ãƒ¼ã‚¿ã‚¢ã‚¯ã‚»ã‚¹å±¤
â”‚  â”œâ”€ index.js          # ã‚¨ãƒ³ãƒˆãƒªãƒ¼ãƒã‚¤ãƒ³ãƒˆ
â”‚  â””â”€ eslint.config.mjs # ãƒªãƒ³ãƒˆè¨­å®š (v9 Flag Config)
â”œâ”€ ä»•æ§˜æ›¸/               # ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆå…¨ä½“ã®ä»•æ§˜ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆ
â””â”€ README.md            # ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆæ¦‚è¦
```

## ğŸ“œ ã‚³ãƒ¼ãƒ‡ã‚£ãƒ³ã‚°è¦ç´„ (Coding Standards)

- **å‘½åè¦å‰‡**: 
    - ãƒ•ã‚¡ã‚¤ãƒ«å: `camelCase.js` (å°æ–‡å­—é–‹å§‹)
    - ãƒ•ã‚©ãƒ«ãƒ€å: `kebab-case` ã¾ãŸã¯æ—¥æœ¬èª (æ—¢å­˜ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆã«å€£ã†)
- **éåŒæœŸå‡¦ç†**: `async/await` ã‚’åŸºæœ¬ã¨ã—ã€`Promise.then()` ã¯é¿ã‘ã‚‹ã€‚
- **ã‚¨ãƒ©ãƒ¼ãƒãƒ³ãƒ‰ãƒªãƒ³ã‚°**: `try-catch` ã§é©åˆ‡ã«ã‚¨ãƒ©ãƒ¼ã‚’æ•æ‰ã—ã€`logger.error` ã§ãƒ­ã‚°ã‚’å‡ºåŠ›ã™ã‚‹ã“ã¨ã€‚
- **ãƒ‡ãƒ¼ã‚¿æ›´æ–°ã®åŸå‰‡**:
    - `updateJson(key, default, updaterFn)` ã‚’ä½¿ç”¨ã—ã¦ãã ã•ã„ã€‚
    - `updaterFn` ã¯ç«¶åˆæ™‚ã«è¤‡æ•°å›å®Ÿè¡Œã•ã‚Œã‚‹å¯èƒ½æ€§ãŒã‚ã‚‹ãŸã‚ã€å¤–éƒ¨çŠ¶æ…‹ã®å¤‰æ›´ã‚„APIå‘¼ã³å‡ºã—ã‚’å«ã¾ãªã„ **ç´”ç²‹é–¢æ•°** ã§ãªã‘ã‚Œã°ãªã‚Šã¾ã›ã‚“ã€‚
    - æ›´æ–°æˆåŠŸæ™‚ã«ã¯è‡ªå‹•çš„ã«ã‚¤ãƒ³ãƒ¡ãƒ¢ãƒªã‚­ãƒ£ãƒƒã‚·ãƒ¥ãŒç ´æ£„ã•ã‚Œã¾ã™ã€‚

### ğŸ›¡ï¸ æ•´åˆæ€§ãƒã‚§ãƒƒã‚¯ (Compliance Check)
ã‚¢ãƒ¼ã‚­ãƒ†ã‚¯ãƒãƒ£ã®å‡çµçŠ¶æ…‹ã‚’ç¶­æŒã™ã‚‹ãŸã‚ã€ä»¥ä¸‹ã®ã‚³ãƒãƒ³ãƒ‰ã§å®šæœŸçš„ã«ã‚»ãƒ«ãƒ•ãƒã‚§ãƒƒã‚¯ã‚’è¡Œã£ã¦ãã ã•ã„ã€‚
```bash
npm run freeze:guard  # éæ¨å¥¨ãª EmbedBuilder ã®æ®‹å­˜ãƒã‚§ãƒƒã‚¯
```

- **çŠ¶æ…‹é·ç§»ã®å‡çµ**:
    - é€è¿ã®çŠ¶æ…‹ï¼ˆstatusï¼‰ãªã©ã¯ã€`bot/utils/constants.js` ã§å®šç¾©ã•ã‚ŒãŸå®šæ•°ã‚’ä½¿ç”¨ã—ã¦ãã ã•ã„ã€‚
    - æ–‡å­—åˆ—ã®ç›´æ›¸ãã«ã‚ˆã‚‹çŠ¶æ…‹åˆ¤å®šã¯ã€Œç ´å£Šçš„å¤‰æ›´ã€ã®ãƒªã‚¹ã‚¯ã¨ãªã‚‹ãŸã‚ç¦æ­¢ã§ã™ã€‚
- **æ¨©é™ç®¡ç†**:
    - Botã‚¤ãƒ³ã‚¿ãƒ©ã‚¯ã‚·ãƒ§ãƒ³ã®æ¨©é™åˆ¤å®šï¼ˆç®¡ç†è€…/é‹å–¶è€…ãƒ­ãƒ¼ãƒ«ï¼‰ã¯ã€`bot/handler/å…±é€š/autoInteractionTemplate.js` ã«é›†ç´„ã•ã‚Œã¦ã„ã¾ã™ã€‚
    - ãƒãƒ³ãƒ‰ãƒ©ãƒ¼å®šç¾©æ™‚ã« `adminOnly: true` ã‚’æŒ‡å®šã™ã‚‹ã“ã¨ã§ã€çµ±ä¸€ã•ã‚ŒãŸæ¨©é™ãƒã‚§ãƒƒã‚¯ãŒè¡Œã‚ã‚Œã¾ã™ã€‚


## ğŸ¨ UI/UX æ¨™æº– (Professional Edition Standard)

- **Embed ã®ä½œæˆ**: `discord.js` ã® `EmbedBuilder` ã‚’ç›´æ¥ new ã™ã‚‹ã®ã¯ç¦æ­¢ã§ã™ã€‚å¿…ãš `bot/utils/embed/embedTemplate.js` ã® `buildPanelEmbed` ã‚’ä½¿ç”¨ã—ã¦ãã ã•ã„ã€‚
- **é…è‰²ã®çµ±ä¸€**: `type` ãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿ã‚’æŒ‡å®šã—ã¦ã€ã‚·ã‚¹ãƒ†ãƒ å…¨ä½“ã§ä¸€è²«ã—ãŸé…è‰²ã‚’ç¶­æŒã—ã¦ãã ã•ã„ã€‚
    - `success`: å‡¦ç†å®Œäº†ãƒ»æˆåŠŸï¼ˆç·‘ï¼‰
    - `warning`: æ³¨æ„ãƒ»å¾…æ©Ÿï¼ˆé»„ï¼‰
    - `error`: ã‚¨ãƒ©ãƒ¼ãƒ»ã‚­ãƒ£ãƒ³ã‚»ãƒ«ï¼ˆèµ¤ï¼‰
    - `info`: æƒ…å ±ãƒ»å‹Ÿé›†ï¼ˆé’ï¼‰
- **ç®¡ç†ç”¨ãƒ—ãƒ¬ãƒ•ã‚£ãƒƒã‚¯ã‚¹**: é‹å–¶è€…å‘ã‘ãƒ‘ãƒãƒ«ã® Embed ã¯ã€ã‚¿ã‚¤ãƒˆãƒ«ã« `[ç®¡ç†]` ã‚’å«ã‚ã‚‹ã“ã¨ã‚’æ¨å¥¨ã—ã¾ã™ã€‚

## ğŸ§© ã‚«ã‚¹ã‚¿ãƒ ID ä»•æ§˜ (Custom ID Spec)

ã‚«ã‚¹ã‚¿ãƒ ID ã¯å¿…ãš `namespace|action|params` ã®å½¢å¼ã§ä½œæˆã—ã¦ãã ã•ã„ã€‚
è©³ç´°ã¯ä»¥ä¸‹ã®ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆã‚’å‚ç…§ã—ã¦ãã ã•ã„ã€‚

ğŸ‘‰ [ã‚«ã‚¹ã‚¿ãƒ ID ä»•æ§˜æ›¸](ä»•æ§˜æ›¸/é–‹ç™ºè€…å‘ã‘/92_ã‚«ã‚¹ã‚¿ãƒ ID.md)

## ğŸ§¹ ã‚³ãƒ¼ãƒ‰å“è³ª (Quality Control)

æœ¬ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆã§ã¯ä»¥ä¸‹ã®ãƒ„ãƒ¼ãƒ«ã‚’å¾¹åº•ã—ã¦ä½¿ç”¨ã—ã¾ã™ã€‚

- **ESLint**: é™çš„è§£æã‚’è¡Œã„ã€ãƒã‚°ã®èŠ½ã‚’æ‘˜ã¿ã¾ã™ã€‚
- **Prettier**: ã‚³ãƒ¼ãƒ‰ã®è¦‹ãŸç›®ã‚’è‡ªå‹•æ•´å½¢ã—ã¾ã™ã€‚

å®Ÿè¡Œã‚³ãƒãƒ³ãƒ‰:
```bash
cd bot
npm run format  # è‡ªå‹•æ•´å½¢
npm run lint    # é™çš„è§£æ
```

## ğŸ§ª ãƒ‡ãƒãƒƒã‚°ãƒ»ãƒ†ã‚¹ãƒˆ (Debug & Test)

### ãƒ­ã‚°ã®ç¢ºèª
`bot/utils/logger.js` ã‚’ä½¿ç”¨ã—ã¦ã€é©åˆ‡ãªãƒ¬ãƒ™ãƒ«ã§ãƒ­ã‚°ã‚’å‡ºåŠ›ã—ã¦ãã ã•ã„ã€‚
- `debug`: é–‹ç™ºæ™‚ã®è©³ç´°æƒ…å ±
- `info`: é€šå¸¸ã®å‹•ä½œè¨˜éŒ²
- `warn`: è»½å¾®ãªå•é¡Œ
- `error`: è‡´å‘½çš„ãªå•é¡Œ

### ãƒ­ãƒ¼ã‚«ãƒ«å®Ÿè¡Œ
`nodemon` ã‚’ä½¿ç”¨ã—ã¦ã„ã¾ã™ã€‚ãƒ•ã‚¡ã‚¤ãƒ«ã‚’ä¿å­˜ã™ã‚‹ã¨è‡ªå‹•çš„ã«å†èµ·å‹•ã—ã¾ã™ã€‚
```bash
npm run dev
```

## ğŸ” ã‚¢ãƒ¼ã‚­ãƒ†ã‚¯ãƒãƒ£å‡çµ (Freeze Context)

æœ¬ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆã¯ã€ä¸»è¦æ©Ÿèƒ½ã®å®Œæˆã«ä¼´ã„ã‚¢ãƒ¼ã‚­ãƒ†ã‚¯ãƒãƒ£ã®ã€Œå‡çµã€ãƒ•ã‚§ãƒ¼ã‚ºã«å…¥ã£ã¦ã„ã¾ã™ã€‚å°†æ¥ã®å …ç‰¢æ€§ã‚’æ‹…ä¿ã™ã‚‹ãŸã‚ã€ä»¥ä¸‹ã®ãƒ«ãƒ¼ãƒ«ã‚’ã€Œå¥‘ç´„ã€ã¨ã—ã¦éµå®ˆã—ã¦ãã ã•ã„ã€‚

### ğŸ§Š å¤‰æ›´ç¦æ­¢ãƒ»å¼·åˆ¶ãƒ«ãƒ¼ãƒ«
1.  **çŠ¶æ…‹ç®¡ç†ã®å®šæ•°åŒ– (RideStatus)**:
    - `bot/utils/constants.js` ã§å®šç¾©ã•ã‚ŒãŸ `RideStatus` ã‚’**å¿…ãš**ä½¿ç”¨ã—ã¦ãã ã•ã„ã€‚
    - çŠ¶æ…‹åˆ¤å®šã‚„æ›´æ–°ã®éš›ã«æ–‡å­—åˆ—ã‚’ç›´æ¥ç”Ÿæˆãƒ»æ¯”è¼ƒã™ã‚‹ã“ã¨ã¯ç¦æ­¢ã§ã™ã€‚
2.  **UI æ¨™æº–ã®å¼·åˆ¶ (buildPanelEmbed)**:
    - Discord Embed ã®ç”Ÿæˆã«ã¯å¿…ãš `buildPanelEmbed` ã‚’ä½¿ç”¨ã—ã¦ãã ã•ã„ã€‚
    - `new EmbedBuilder()` ã«ã‚ˆã‚‹ç‹¬è‡ªã‚¹ã‚¿ã‚¤ãƒ«ã®ä½œæˆã¯ã€Professional Edition ã®çµ±ä¸€æ„Ÿã‚’æãªã†ãŸã‚ç¦æ­¢ã§ã™ã€‚
3.  **ãƒ‡ãƒ¼ã‚¿æ•´åˆæ€§ã®å¼·åˆ¶ (updateJson)**:
    - æ°¸ç¶šåŒ–ãƒ‡ãƒ¼ã‚¿ã®æ›´æ–°ã¯ã€åŸå‰‡ã¨ã—ã¦ `updateJson` çµŒç”±ã§è¡Œã£ã¦ãã ã•ã„ã€‚
    - `writeJson` ã¯åˆæœŸåŒ–ã‚„ãƒªãƒ¼ãƒ‰ã‚ªãƒ³ãƒªãƒ¼ãªè¿½è¨˜ãªã©ã€ç«¶åˆãƒªã‚¹ã‚¯ãŒãªã„å ´åˆã«é™å®šã—ã¦ä½¿ç”¨ã—ã¦ãã ã•ã„ã€‚
4.  **ã‚­ãƒ£ãƒƒã‚·ãƒ¥æ•´åˆæ€§**:
    - æ›¸ãè¾¼ã¿æˆåŠŸæ™‚ã«ã¯å¿…ãš `invalidateCache(key)` ãŒå‘¼ã³å‡ºã•ã‚Œã‚‹æ§‹é€ ã‚’ç¶­æŒã—ã¦ãã ã•ã„ï¼ˆ`updateJson` ã¯å†…éƒ¨ã§è‡ªå‹•å®Ÿè¡Œã—ã¾ã™ï¼‰ã€‚

### ğŸ§± é€è¿çŠ¶æ…‹é·ç§»è¡¨ (Ride State Transitions)
é€è¿ã®çŠ¶æ…‹ã¯ä»¥ä¸‹ã®ãƒ«ãƒ¼ãƒ«ã«å¾“ã£ã¦ã®ã¿é·ç§»å¯èƒ½ã§ã™ã€‚ã“ã‚Œã«åã™ã‚‹çŠ¶æ…‹é·ç§»ã®è¿½åŠ ã¯åŸå‰‡ç¦æ­¢ã§ã™ã€‚

| å…ƒã®çŠ¶æ…‹ | é·ç§»å…ˆã®çŠ¶æ…‹ | èª¬æ˜ |
| :--- | :--- | :--- |
| `pending` | `matched`, `cancelled` | ãƒ‰ãƒ©ã‚¤ãƒãƒ¼ä¸åœ¨æ™‚ã¯å¾…æ©Ÿãƒªã‚¹ãƒˆã¸ |
| `matched` | `approaching`, `started`, `cancelled` | ãƒãƒƒãƒãƒ³ã‚°å®Œäº† -> åˆæµã¸ |
| `approaching`| `started`, `cancelled` | è¿ãˆã«ç§»å‹•ä¸­ |
| `started` | `completed`, `cancelled` | é€è¿å®Ÿæ–½ä¸­ |
| `completed` | (çµ‚ç«¯) | å®Œäº†ãƒ»å±¥æ­´ä¿å­˜æ¸ˆã¿ |
| `cancelled` | (çµ‚ç«¯) | ä¸­æ­¢ |

---
*æœ€çµ‚æ›´æ–°: 2026-01-25 - System Consolidation & Freeze å®Œäº†*
