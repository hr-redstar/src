# 送迎システム 運用・処理フロー (Professional Edition)

## 1. 初期導入・セットアップ
1.  Discord Botをサーバーに導入。
2.  `/パネル設置パネル` コマンドを実行し、基本設定用パネルを設置。
3.  **初期設定**:
    *   管理者パネルから「カテゴリー設定」「チャンネル設定」を完了。
    *   方面リスト（目的地）を登録。
4.  **パネル設置**:
    *   登録パネル（利用者・送迎者別）を設置。
    *   送迎一覧パネル（稼働状況可視化）を設置。
    *   メイン操作パネル（利用者用・送迎者用）を設置。

---

## 2. ユーザー登録フロー

### A. 送迎者（ドライバー）登録
1.  **登録操作**: 「送迎者登録パネル」で車両情報・乗車定員・**活動区域（拠点）**を入力。
2.  **管理系処理**: 送迎者の個人メモチャンネルに「登録情報Embed」が送信される。

### B. 利用者（キャスト・ゲスト）登録
1.  **登録操作**: 「利用者登録パネル」で店舗名・**方面（ピックアップ地点）**を入力。
2.  **管理系処理**: 利用者の個人メモチャンネルに「登録情報Embed」が送信される。

---

## 3. 送迎マッチングフロー (Professional仕様)

### ステップ1：出勤
1.  送迎者が「出勤」ボタンを押し、**現在地**を入力。
2.  送迎一覧パネル（待機列）に名前が表示される。

### ステップ2：配車依頼
1.  利用者が「配車依頼」ボタンを押し、**方面（目的地）**と**人数**を選択。
2.  システムが待機列の先頭ドライバーと自動マッチング。

### ステップ3：マッチング成立・VC作成
1.  **プライベートVC作成**: 利用者と送迎者のみがアクセスできるVCが作成される。
    *   タイトル: `MM/DD HH:mm~--:-- 【方面】→【方角】`
2.  **同期Embed送信**: VC内、運営ログ、利用者メモの3箇所に**同一の管理用Embed**が送信される。
3.  **DM通知**: 両者にVCリンク付きの通知が届く。
4.  **スレッド作成**: 利用者メモ内にやり取り用の専用スレッドが自動作成される。

### ステップ4：進捗管理 (リアルタイム同期)
1.  **向かっています**: 送迎者がボタンを押すと、すべてのEmbedが「移動中」に更新される。
2.  **送迎開始**: 合流時にボタンを押すと、すべてのEmbedが「開始（時刻表示）」に更新される。
3.  **送迎終了**: 目的地到着時にボタンを押すと、すべてのEmbedが「終了」に更新され、履歴として固定される。

---

## 4. 送迎終了後の処理
1.  **待機列復帰**: 送迎者に「待機列に戻る」ボタン付きDMが送信される。
2.  **評価依頼**: 利用者に「口コミ評価」をお願いするDMが送信される。
3.  **VC保持・削除**: 1週間後にVCが自動削除される（延長ボタンで回避可能）。

---

## 5. 相乗りフロー
1.  **募集開始**: 通常配車確定時に、空席がある場合は「相乗り募集チャンネル」に自動投稿。
2.  **内容**: 出発地・経由方面・目的地が表示される。
3.  **参加**: 他の利用者が「相乗り希望」を押し、ドライバーが承認すると、既存のVCへ招待・ルートが再計算される。
