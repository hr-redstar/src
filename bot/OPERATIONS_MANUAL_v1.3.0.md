# 🚕 送迎者Bot 運用マニュアル (v1.3.0)

> [!IMPORTANT]
> **最終更新日**: 2026-01-17  
> **PDF出力・印刷時の注意**: 本ドキュメント内のローカルファイルへのリンクは、PDF化すると機能しない場合があります。その際は GitHub リポジトリまたは配布パッケージ内のファイルを参照してください。また、図が崩れる場合は各種画像ファイル（assetsフォルダ内）を直接ご確認ください。

## 📋 目次
- [1. はじめに](#1-はじめに)
  - [📌 概要](#概要)
  - [⚡ システム構造図](#システム構造図)
- [🛠️ 主要コマンド・ボタン一覧](#主要コマンド・ボタン一覧)
- [2. 管理者・運営者向けガイド](#2-管理者運営者向けガイド)
  - [2.1 パネル設置パネル](#21-パネル設置パネル-panel-setup)
  - [2.2 管理者パネル](#22-管理者パネル-admin)
- [3. 送迎者向けガイド](#3-送迎者向けガイド)
  - [3.1 出勤管理](#31-出勤管理)
  - [3.2 相乗り承認フロー](#32-相乗り承認フロー)
- [4. 利用者向けガイド](#4-利用者向けガイド)
  - [4.1 配車フロー](#41-配車フロー)
  - [4.2 相乗り (Carpool)](#42-相乗り-carpool)
- [5. システム保守・Q&A](#5-システム保守qa)
  - [5.1 Q&A（現場トラブル対応）](#51-qa現場トラブル対応)
- [📖 関連リソース](#関連リソース)

---

## 1. はじめに

### 📌 概要
このBotは、Discord上での送迎依頼・配車管理、および送迎者の評価・統計管理を自動化するシステムです。
最新バージョン **v1.3.0** では、高度な相乗りシステム、詳細な走行履歴、および洗練された管理者パネルが統合されています。

### ⚡ システム構造図
![システム構造・データフロー図](./assets/system_flow.png)
*図1: システム全体のデータ・処理フロー（ユーザー操作～データベース同期）*

---

## 🛠️ 主要コマンド・ボタン一覧

| 対象者| 操作内容| 実行方法/ボタン| 機能・目的| 備考 |
| :--- | :--- | :--- | :--- | :--- |
| **全体**| 送迎依頼| `/依頼` または案内パネル| 配車リクエストを開始| ✅ [推奨] 泥酔時は目的地入力をスキップ可能 |
| **送迎者**| 出勤| 「今から行けます」ボタン| 待機列(FIFO)に参加| ⚠️ [重要] 待機場所が変わったら「現在地更新」 |
| **送迎者**| 退勤| 「退勤します」ボタン| 待機列から離脱| ✅ [推奨] 休憩時も一度退勤を推奨 |
| **送迎者**| 相乗り承認| DMの「許可」ボタン| 相乗りの受諾とルート調整| ⚠️ [重要] 承認後の「区間選択」を忘れずに |
| **管理者**| パネル設置| `/パネル設置パネル`| 各種パネルの送信・管理| ✅ [自動] Bot再起動時に自動で最新化される |
| **管理者**| システム管理| `/管理者パネル`| ログ・統計・評価の管理| ⚠️ [秘匿] 機密情報はサブパネルで管理 |

---

## 2. 管理者・運営者向けガイド

### 2.1 パネル設置パネル (`/panel-setup`)
Botの各機能をサーバー内に設置するための司令塔です。
![管理者パネルプレビュー](./assets/admin_panel.png)
- **新規設置**: 設置したいパネルのボタンを押し、送信先チャンネルを選択。
- **自動同期**: 設置済みのパネルはBot起動時に自動で復旧。
- **案内パネル**: 🔰マニュアルを確認しなくても基本操作ができるよう構成されています。

### 2.2 管理者パネル (`/admin`)
- **🏆 評価・統計・履歴**: 
    - メインパネルから独立したサブパネルで、機密性の高い履歴や統計を確認。
    - **口コミ確認**: 全送迎の評価ページネーション対応。
    - **履歴表示**: 「送迎履歴詳しく」より全走行ログを確認。具体的な手順は [Q&A](#51-qa現場トラブル対応) も参照してください。

---

## 3. 送迎者向けガイド

### 3.1 出勤管理
![送迎者パネルプレビュー](./assets/driver_panel.png)
- **現在地更新**: 待機場所が変わった際、利用者に最新情報を伝えるためにこまめに更新してください。

### 3.2 相乗り承認フロー
![相乗りフロー図](./assets/carpool_flow.png)
*図2: 利用者→送迎者への相乗り承認の流れ*

---

## 4. 利用者向けガイド

### 4.1 配車フロー
1.  **方面選択**: `/依頼` 後、表示される方面ボタンを選択。
2.  **目的地入力**: モーダルに目印などを記入。
3.  **マッチング**: ドライバーが決まると自動的にVCが作成されます。詳細は [Q&A](#51-qa現場トラブル対応) を参照してください。

### 4.2 相乗り (Carpool)
- 稼働中の車両がある場合、「相乗りする」ボタンが表示されます。
- 申請後、ドライバーが承認すると同じVCへ招待されます。

---

## 5. システム保守・Q&A

### 5.1 Q&A（現場トラブル対応）

**Q. 方面ボタンが表示されません**
> **A.** 管理者パネルの「方面リスト編集」より、方面を一つ以上登録してください。詳しくは [2.2 管理者パネル](#22-管理者パネル-admin) を参照。

**Q. ドライバーが承認したのにルート（地図）が変わりません**
> **A.** ドライバーが承認後の「区間選択」を完了していない可能性があります。DMでの最終確認ボタンまで押すよう伝えてください。

**Q. 送迎終了後にVCが消えません**
> **A.** 誤削除防止のため、標準1週間は保持されます。手動で消したい場合は [管理者パネル](#22-管理者パネル-admin) から操作してください。

**Q. VC内のボタンが反応しません**
> **A.** 通信エラーやDiscord APIの問題の可能性があります。数秒待って再試行してください。

**Q. 評価を間違えて送ってしまった**
> **A.** 確定後の修正は利用者側からはできません。管理者へ調整を依頼してください。

---

## 📖 関連リソース
- [リリースノート](file:///c:/Users/User/Desktop/送迎bot/src/bot/RELEASE_NOTES.md)
- [フェーズ9検証記録](file:///c:/Users/User/.gemini/antigravity/brain/4b410c02-14bd-41db-97d0-b89047dcf235/walkthrough_v9.md)
